<!DOCTYPE html>
<html lang="en" class="scroll-smooth"><head><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<title>Interactive CV | Lev Kislyuk</title>
<meta name="description" content="Explore Lev Kislyuk's career in a 3D interactive city — drive through zones to discover projects, experience, and skills built with Three.js.">
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://code.iconify.design/3/3.1.0/iconify.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&amp;display=swap" rel="stylesheet">
<style>
body {
font-family: 'Inter', sans-serif;
background-color: #09090b;
overflow: hidden;
touch-action: none;
}
#canvas-container {
width: 100%;
height: 100%;
display: block;
}
.modal-panel {
transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
backdrop-filter: blur(12px);
}
.key-cap {
box-shadow: 0 4px 0 #27272a;
transition: all 0.1s;
}
.key-cap:active, .key-cap.pressed {
transform: translateY(4px);
box-shadow: 0 0 0 #27272a;
}
.world-label {
position: absolute;
transform: translate(-50%, -50%);
pointer-events: none;
transition: opacity 0.3s;
z-index: 10;
}
</style></head>
<body class="bg-zinc-950 text-zinc-300 antialiased h-screen w-screen overflow-hidden">

    <!-- UI LAYER -->
    <div class="fixed inset-0 z-50 pointer-events-none flex flex-col justify-between p-6 sm:p-8">
        
        <!-- First-time Tutorial Overlay -->
        <div id="tutorial" class="absolute inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center pointer-events-auto z-[200] transition-opacity duration-500" style="display: none;">
            <div class="max-w-md bg-zinc-900 border border-white/20 rounded-2xl p-8 text-center space-y-6 shadow-2xl">
                <div class="w-16 h-16 mx-auto bg-gradient-to-br from-indigo-500 to-purple-500 rounded-full flex items-center justify-center">
                    <span class="iconify text-white text-3xl" data-icon="lucide:gamepad-2"></span>
                </div>
                <div>
                    <h2 class="text-2xl font-bold text-white mb-2">Welcome to My Interactive CV</h2>
                    <p class="text-sm text-zinc-400">Drive through the city to explore my career journey</p>
                </div>
                <div class="space-y-4">
                    <div class="flex items-center gap-4 bg-zinc-800/50 p-4 rounded-lg">
                        <div class="flex gap-1">
                            <kbd class="px-3 py-2 bg-zinc-700 text-white text-xs rounded font-mono shadow">W</kbd>
                            <kbd class="px-3 py-2 bg-zinc-700 text-white text-xs rounded font-mono shadow">A</kbd>
                            <kbd class="px-3 py-2 bg-zinc-700 text-white text-xs rounded font-mono shadow">S</kbd>
                            <kbd class="px-3 py-2 bg-zinc-700 text-white text-xs rounded font-mono shadow">D</kbd>
                        </div>
                        <span class="text-xs text-zinc-300 text-left flex-1">Drive & Steer</span>
                    </div>
                    <div class="flex items-center gap-4 bg-zinc-800/50 p-4 rounded-lg">
                        <kbd class="px-4 py-2 bg-zinc-700 text-white text-xs rounded font-mono shadow">ENTER</kbd>
                        <span class="text-xs text-zinc-300 text-left flex-1">Open zone info</span>
                    </div>
                </div>
                <button id="startBtn" class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white font-semibold py-3 rounded-lg transition-all shadow-lg hover:shadow-xl">
                    Start Exploring
                </button>
                <p class="text-[10px] text-zinc-500">Find the glowing zones around the city</p>
            </div>
        </div>
        
        <!-- Header -->
        <div class="flex justify-between items-start w-full">
            <div class="flex flex-col gap-1 pointer-events-auto">
                <div class="flex items-center gap-2">
                    <div class="w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse"></div>
                    <h1 class="text-xs font-semibold tracking-tight text-white uppercase">Lev Kislyuk [Interactive CV]</h1>
                </div>
                <div class="text-[10px] text-zinc-500 tracking-wide font-mono" id="coords">POS: 0, 0</div>
            </div>

            <!-- Back to Website Button -->
            <a href="projects.html" class="bg-zinc-900/90 backdrop-blur border border-white/10 rounded-lg px-4 py-2.5 flex items-center gap-2 text-xs font-medium text-white hover:bg-zinc-800/90 transition-colors pointer-events-auto shadow-lg group">
                <span class="iconify" data-icon="lucide:arrow-left" data-width="14"></span>
                <span class="hidden sm:inline">Back to Portfolio</span>
                <span class="sm:hidden">Exit</span>
            </a>
        </div>

        <!-- Stats Panel (Bottom Left) -->
        <div class="absolute bottom-6 left-6 bg-zinc-900/90 backdrop-blur border border-white/10 rounded-lg p-3 pointer-events-auto hidden md:block shadow-lg space-y-1">
            <div class="text-[9px] uppercase text-zinc-500 tracking-wider mb-1.5 font-medium">Progress</div>
            <div class="flex items-center gap-2">
                <span class="iconify text-purple-400" data-icon="lucide:map-pin" data-width="12"></span>
                <span class="text-xs text-zinc-300"><span id="zonesFound">0</span>/3 Zones</span>
            </div>
            <div class="flex items-center gap-2">
                <span class="iconify text-blue-400" data-icon="lucide:gauge" data-width="12"></span>
                <span class="text-xs text-zinc-300"><span id="distanceTraveled">0</span>m</span>
            </div>
        </div>
    </div>

    <!-- 3D CANVAS -->
    <div id="canvas-container" class="relative z-0"></div>

    <!-- Control Hints (Top Right - Desktop) -->
    <div class="fixed top-20 right-6 bg-zinc-900/90 backdrop-blur border border-white/5 rounded-lg p-3 max-w-[200px] text-right pointer-events-auto hidden md:block shadow-lg z-40">
        <p class="text-[10px] uppercase text-zinc-500 tracking-widest mb-2 font-medium">Controls</p>
        <div class="flex justify-end gap-1 mb-1">
            <div class="w-7 h-7 rounded bg-zinc-800 border border-white/5 flex items-center justify-center text-[10px] font-bold text-zinc-300 key-cap" id="key-w">W</div>
        </div>
        <div class="flex justify-end gap-1">
            <div class="w-7 h-7 rounded bg-zinc-800 border border-white/5 flex items-center justify-center text-[10px] font-bold text-zinc-300 key-cap" id="key-a">A</div>
            <div class="w-7 h-7 rounded bg-zinc-800 border border-white/5 flex items-center justify-center text-[10px] font-bold text-zinc-300 key-cap" id="key-s">S</div>
            <div class="w-7 h-7 rounded bg-zinc-800 border border-white/5 flex items-center justify-center text-[10px] font-bold text-zinc-300 key-cap" id="key-d">D</div>
        </div>
        <div class="text-[9px] text-zinc-500 mt-2">Arrow keys also work</div>
    </div>

    <!-- Proximity Action Alert -->
    <div id="proximity-alert" class="fixed top-2/3 left-1/2 -translate-x-1/2 -translate-y-1/2 opacity-0 transition-all duration-300 transform scale-90 pointer-events-none flex flex-col items-center z-50">
        <div class="bg-white text-black px-5 py-3 rounded-full text-sm font-semibold tracking-wide flex items-center gap-3 shadow-[0_0_40px_rgba(255,255,255,0.4)] animate-pulse">
            <span class="iconify" data-icon="lucide:arrow-down" data-width="16"></span>
            <span>Press <kbd class="px-2 py-1 bg-zinc-800 text-white rounded text-xs mx-1">ENTER</kbd> or <kbd class="px-2 py-1 bg-zinc-800 text-white rounded text-xs mx-1">SPACE</kbd></span>
        </div>
    </div>


    <!-- LABELS -->
    <div id="labels-container" class="absolute inset-0 pointer-events-none overflow-hidden z-10">
        <div id="label-about" class="world-label flex flex-col items-center gap-3 opacity-0">
            <div class="relative group">
                <div class="absolute -inset-2 bg-purple-500/30 rounded-full blur-md animate-pulse"></div>
                <div class="w-12 h-12 bg-zinc-900 border border-purple-500/50 rounded-full flex items-center justify-center relative z-10">
                    <span class="iconify text-purple-400" data-icon="lucide:user" data-width="20"></span>
                </div>
            </div>
            <div class="text-center">
                <div class="bg-zinc-900/80 backdrop-blur px-2 py-1 rounded border border-white/10">
                    <div class="text-[10px] font-bold text-white tracking-widest uppercase">About HQ</div>
                </div>
                <div class="w-0.5 h-8 bg-gradient-to-b from-purple-500 to-transparent mx-auto mt-1"></div>
            </div>
        </div>
        
        <div id="label-experience" class="world-label flex flex-col items-center gap-3 opacity-0">
             <div class="relative group">
                <div class="absolute -inset-2 bg-blue-500/30 rounded-full blur-md animate-pulse"></div>
                <div class="w-12 h-12 bg-zinc-900 border border-blue-500/50 rounded-full flex items-center justify-center relative z-10">
                    <span class="iconify text-blue-400" data-icon="lucide:briefcase" data-width="20"></span>
                </div>
            </div>
            <div class="text-center">
                <div class="bg-zinc-900/80 backdrop-blur px-2 py-1 rounded border border-white/10">
                    <div class="text-[10px] font-bold text-white tracking-widest uppercase">Experience</div>
                </div>
                <div class="w-0.5 h-8 bg-gradient-to-b from-blue-500 to-transparent mx-auto mt-1"></div>
            </div>
        </div>

        <div id="label-portfolio" class="world-label flex flex-col items-center gap-3 opacity-0">
             <div class="relative group">
                <div class="absolute -inset-2 bg-emerald-500/30 rounded-full blur-md animate-pulse"></div>
                <div class="w-12 h-12 bg-zinc-900 border border-emerald-500/50 rounded-full flex items-center justify-center relative z-10">
                    <span class="iconify text-emerald-400" data-icon="lucide:layers" data-width="20"></span>
                </div>
            </div>
            <div class="text-center">
                <div class="bg-zinc-900/80 backdrop-blur px-2 py-1 rounded border border-white/10">
                    <div class="text-[10px] font-bold text-white tracking-widest uppercase">Projects</div>
                </div>
                <div class="w-0.5 h-8 bg-gradient-to-b from-emerald-500 to-transparent mx-auto mt-1"></div>
            </div>
        </div>
    </div>

    <!-- MODALS -->
    <div id="modal-container" class="fixed inset-0 z-[100] bg-black/60 backdrop-blur-md hidden flex items-center justify-center p-4">
        
        <div id="modal-about" class="modal-panel w-full max-w-2xl bg-zinc-950 border border-white/10 rounded-xl shadow-2xl overflow-hidden hidden transform scale-95 opacity-0">
            <div class="h-1 w-full bg-gradient-to-r from-purple-500 via-indigo-500 to-purple-500"></div>
            <div class="p-8">
                <div class="flex items-start justify-between mb-6">
                    <div>
                        <h2 class="text-xl font-semibold text-white tracking-tight">Lev Kislyuk</h2>
                        <p class="text-xs text-zinc-500 mt-1 uppercase tracking-wider">Technical Product Leader & Analytics Engineer</p>
                    </div>
                    <button class="close-modal text-zinc-500 hover:text-white transition-colors">
                        <span class="iconify" data-icon="lucide:x" data-width="20"></span>
                    </button>
                </div>
                <div class="grid md:grid-cols-2 gap-8">
                    <div class="space-y-4 text-sm text-zinc-400 leading-relaxed">
                        <p>Technical product leader who bridges engineering and user needs. 6+ years in data/analytics engineering across consulting, crypto, and AI startups.</p>
                        <p>I thrive at early-stage companies where I can stay hands-on technically while deeply understanding what users actually need — from building 50M-record data warehouses to shipping AI-powered DeFi protocols.</p>
                    </div>
                    <div class="space-y-3">
                        <div class="bg-zinc-900 p-3 rounded border border-white/5 flex items-center gap-3">
                            <span class="iconify text-purple-400" data-icon="lucide:briefcase" data-width="16"></span>
                            <span class="text-xs text-zinc-300">Technical Product Leader</span>
                        </div>
                        <div class="bg-zinc-900 p-3 rounded border border-white/5 flex items-center gap-3">
                            <span class="iconify text-purple-400" data-icon="lucide:mail" data-width="16"></span>
                            <span class="text-xs text-zinc-300">ls.kislyuk@gmail.com</span>
                        </div>
                        <div class="bg-zinc-900 p-3 rounded border border-white/5 flex items-center gap-3">
                            <span class="iconify text-purple-400" data-icon="lucide:github" data-width="16"></span>
                            <span class="text-xs text-zinc-300">github.com/levkiss</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="modal-experience" class="modal-panel w-full max-w-2xl bg-zinc-950 border border-white/10 rounded-xl shadow-2xl overflow-hidden hidden transform scale-95 opacity-0">
            <div class="h-1 w-full bg-gradient-to-r from-blue-500 via-cyan-500 to-blue-500"></div>
            <div class="p-8">
                <div class="flex items-start justify-between mb-8">
                    <div>
                        <h2 class="text-xl font-semibold text-white tracking-tight">Career Journey</h2>
                        <p class="text-xs text-zinc-500 mt-1 uppercase tracking-wider">Professional Experience</p>
                    </div>
                    <button class="close-modal text-zinc-500 hover:text-white transition-colors">
                        <span class="iconify" data-icon="lucide:x" data-width="20"></span>
                    </button>
                </div>
                <div class="space-y-8 max-h-96 overflow-y-auto pr-2">
                    <div class="relative pl-6 border-l border-zinc-800">
                        <div class="absolute -left-1.5 top-1 w-3 h-3 rounded-full bg-blue-500 ring-4 ring-zinc-950"></div>
                        <h3 class="text-sm font-semibold text-white">Technical Product</h3>
                        <p class="text-[10px] text-blue-400 mb-1 uppercase tracking-wider font-mono">Pupas AI • May 2025 - Dec 2025</p>
                        <p class="text-xs text-zinc-400 mt-2">Took an AI-powered DeFi yield optimizer from idea to production. Secured funding, led a team of 5, and architected the full stack: Ride smart contracts, AI agents (LangChain/LangGraph with RAG), Telegram bots, and web frontend. Achieved 190% APY managing $200K TVL with 60+ active investors.</p>
                        <div class="flex flex-wrap gap-1.5 mt-3">
                            <span class="px-2 py-0.5 bg-zinc-800 text-[9px] uppercase font-mono rounded text-zinc-400">LangChain</span>
                            <span class="px-2 py-0.5 bg-zinc-800 text-[9px] uppercase font-mono rounded text-zinc-400">LangGraph</span>
                            <span class="px-2 py-0.5 bg-zinc-800 text-[9px] uppercase font-mono rounded text-zinc-400">RAG</span>
                            <span class="px-2 py-0.5 bg-zinc-800 text-[9px] uppercase font-mono rounded text-zinc-400">Python</span>
                            <span class="px-2 py-0.5 bg-zinc-800 text-[9px] uppercase font-mono rounded text-zinc-400">Ride</span>
                            <span class="px-2 py-0.5 bg-zinc-800 text-[9px] uppercase font-mono rounded text-zinc-400">Smart Contracts</span>
                        </div>
                    </div>
                    <div class="relative pl-6 border-l border-zinc-800">
                        <div class="absolute -left-1.5 top-1 w-3 h-3 rounded-full bg-zinc-700 ring-4 ring-zinc-950"></div>
                        <h3 class="text-sm font-semibold text-white">Lead Analytics Engineer</h3>
                        <p class="text-[10px] text-zinc-500 mb-1 uppercase tracking-wider font-mono">Pygma.me • Dec 2023 - May 2025</p>
                        <p class="text-xs text-zinc-400 mt-2">First data hire at an AI-powered Instagram growth tool. Built the entire analytics stack from zero: BigQuery, Airflow, dbt, Mixpanel, GTM/GA4. Processed 20TB of Instagram data for ML training. Shipped an attribution system matching user events to Meta/Google Ads with 78% accuracy.</p>
                        <div class="flex flex-wrap gap-1.5 mt-3">
                            <span class="px-2 py-0.5 bg-zinc-800 text-[9px] uppercase font-mono rounded text-zinc-400">BigQuery</span>
                            <span class="px-2 py-0.5 bg-zinc-800 text-[9px] uppercase font-mono rounded text-zinc-400">dbt</span>
                            <span class="px-2 py-0.5 bg-zinc-800 text-[9px] uppercase font-mono rounded text-zinc-400">Airflow</span>
                            <span class="px-2 py-0.5 bg-zinc-800 text-[9px] uppercase font-mono rounded text-zinc-400">Mixpanel</span>
                            <span class="px-2 py-0.5 bg-zinc-800 text-[9px] uppercase font-mono rounded text-zinc-400">GTM</span>
                        </div>
                    </div>
                    <div class="relative pl-6 border-l border-zinc-800">
                        <div class="absolute -left-1.5 top-1 w-3 h-3 rounded-full bg-zinc-700 ring-4 ring-zinc-950"></div>
                        <h3 class="text-sm font-semibold text-white">Senior Data Engineer</h3>
                        <p class="text-[10px] text-zinc-500 mb-1 uppercase tracking-wider font-mono">Aero eCommerce • Mar 2023 - Jun 2024</p>
                        <p class="text-xs text-zinc-400 mt-2">Designed scalable data warehouses on Yandex Cloud processing 50M records daily with sub-second queries. Built data quality framework (Great Expectations) achieving 95% accuracy. Cut storage costs by 30%. Scaled the data engineering team through training and technical interviews.</p>
                        <div class="flex flex-wrap gap-1.5 mt-3">
                            <span class="px-2 py-0.5 bg-zinc-800 text-[9px] uppercase font-mono rounded text-zinc-400">Clickhouse</span>
                            <span class="px-2 py-0.5 bg-zinc-800 text-[9px] uppercase font-mono rounded text-zinc-400">Airflow</span>
                            <span class="px-2 py-0.5 bg-zinc-800 text-[9px] uppercase font-mono rounded text-zinc-400">dbt</span>
                            <span class="px-2 py-0.5 bg-zinc-800 text-[9px] uppercase font-mono rounded text-zinc-400">Nifi</span>
                            <span class="px-2 py-0.5 bg-zinc-800 text-[9px] uppercase font-mono rounded text-zinc-400">Great Expectations</span>
                        </div>
                    </div>
                    <div class="relative pl-6 border-l border-zinc-800">
                        <div class="absolute -left-1.5 top-1 w-3 h-3 rounded-full bg-zinc-700 ring-4 ring-zinc-950"></div>
                        <h3 class="text-sm font-semibold text-white">Analytics Engineer in Web3</h3>
                        <p class="text-[10px] text-zinc-500 mb-1 uppercase tracking-wider font-mono">Private Investor • Sep 2022 - Apr 2023</p>
                        <p class="text-xs text-zinc-400 mt-2">Built a private analytics platform unifying fragmented DeFi data across 6 blockchain networks (EVM chains, Tron, Near). Deployed and maintained Clickhouse, Airflow, Grafana, and blockchain nodes. Created ETL pipelines from 8+ sources for smart contract labeling.</p>
                        <div class="flex flex-wrap gap-1.5 mt-3">
                            <span class="px-2 py-0.5 bg-zinc-800 text-[9px] uppercase font-mono rounded text-zinc-400">Clickhouse</span>
                            <span class="px-2 py-0.5 bg-zinc-800 text-[9px] uppercase font-mono rounded text-zinc-400">PostgreSQL</span>
                            <span class="px-2 py-0.5 bg-zinc-800 text-[9px] uppercase font-mono rounded text-zinc-400">Web3.py</span>
                            <span class="px-2 py-0.5 bg-zinc-800 text-[9px] uppercase font-mono rounded text-zinc-400">Airflow</span>
                            <span class="px-2 py-0.5 bg-zinc-800 text-[9px] uppercase font-mono rounded text-zinc-400">Grafana</span>
                        </div>
                    </div>
                    <div class="relative pl-6 border-l border-zinc-800">
                        <div class="absolute -left-1.5 top-1 w-3 h-3 rounded-full bg-zinc-700 ring-4 ring-zinc-950"></div>
                        <h3 class="text-sm font-semibold text-white">Data Engineer</h3>
                        <p class="text-[10px] text-zinc-500 mb-1 uppercase tracking-wider font-mono">Glowbyte Consulting • Jun 2019 - Sep 2022</p>
                        <p class="text-xs text-zinc-400 mt-2">Built and maintained 13 enterprise data integrations managing 1,500+ tables across banking and retail clients. Developed real-time analytics tools reducing processing latency by 30%. Established CI/CD pipelines across client environments. Contributed to SIBUR's data-driven transformation and Lemana PRO's AI demand forecasting.</p>
                        <div class="flex flex-wrap gap-1.5 mt-3">
                            <span class="px-2 py-0.5 bg-zinc-800 text-[9px] uppercase font-mono rounded text-zinc-400">PostgreSQL</span>
                            <span class="px-2 py-0.5 bg-zinc-800 text-[9px] uppercase font-mono rounded text-zinc-400">Greenplum</span>
                            <span class="px-2 py-0.5 bg-zinc-800 text-[9px] uppercase font-mono rounded text-zinc-400">Vertica</span>
                            <span class="px-2 py-0.5 bg-zinc-800 text-[9px] uppercase font-mono rounded text-zinc-400">Python</span>
                            <span class="px-2 py-0.5 bg-zinc-800 text-[9px] uppercase font-mono rounded text-zinc-400">CI/CD</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="modal-portfolio" class="modal-panel w-full max-w-3xl bg-zinc-950 border border-white/10 rounded-xl shadow-2xl overflow-hidden hidden transform scale-95 opacity-0">
            <div class="h-1 w-full bg-gradient-to-r from-emerald-500 via-green-500 to-emerald-500"></div>
            <div class="p-8">
                <div class="flex items-start justify-between mb-8">
                    <div>
                        <h2 class="text-xl font-semibold text-white tracking-tight">Featured Projects</h2>
                        <p class="text-xs text-zinc-500 mt-1 uppercase tracking-wider">Selected Works</p>
                    </div>
                    <button class="close-modal text-zinc-500 hover:text-white transition-colors">
                        <span class="iconify" data-icon="lucide:x" data-width="20"></span>
                    </button>
                </div>
                <div class="grid sm:grid-cols-2 gap-4 max-h-[28rem] overflow-y-auto pr-2">
                    <div class="group relative bg-zinc-900 rounded-lg border border-white/5 overflow-hidden hover:border-emerald-500/50 transition-all">
                        <div class="p-5">
                            <div class="flex items-center gap-3 mb-3">
                                <img src="assets/pupas-logo.png" alt="Pupas AI" class="w-8 h-8 rounded-md object-contain bg-zinc-800 border border-white/5">
                                <h4 class="text-sm font-medium text-white">Pupas AI Protocol</h4>
                            </div>
                            <p class="text-xs text-zinc-400 mb-3">AI-powered DeFi yield optimizer built from idea to production. 190% APY, $200K TVL, 60+ investors.</p>
                            <div class="flex flex-wrap gap-1.5">
                                <span class="px-2 py-0.5 bg-zinc-800 text-[9px] uppercase font-mono rounded text-zinc-400">LangChain</span>
                                <span class="px-2 py-0.5 bg-zinc-800 text-[9px] uppercase font-mono rounded text-zinc-400">LangGraph</span>
                                <span class="px-2 py-0.5 bg-zinc-800 text-[9px] uppercase font-mono rounded text-zinc-400">RAG</span>
                                <span class="px-2 py-0.5 bg-zinc-800 text-[9px] uppercase font-mono rounded text-zinc-400">Python</span>
                                <span class="px-2 py-0.5 bg-zinc-800 text-[9px] uppercase font-mono rounded text-zinc-400">Ride</span>
                                <span class="px-2 py-0.5 bg-zinc-800 text-[9px] uppercase font-mono rounded text-zinc-400">Smart Contracts</span>
                                <span class="px-2 py-0.5 bg-zinc-800 text-[9px] uppercase font-mono rounded text-zinc-400">Telegram Bots</span>
                            </div>
                        </div>
                    </div>
                    <div class="group relative bg-zinc-900 rounded-lg border border-white/5 overflow-hidden hover:border-emerald-500/50 transition-all">
                        <div class="p-5">
                            <div class="flex items-center gap-3 mb-3">
                                <img src="assets/pygma-logo.avif" alt="Pygma" class="w-8 h-8 rounded-md object-contain bg-zinc-800 border border-white/5">
                                <h4 class="text-sm font-medium text-white">Pygma Analytics</h4>
                            </div>
                            <p class="text-xs text-zinc-400 mb-3">Built entire analytics stack from zero for AI startup. 20TB data processed, 78% attribution accuracy.</p>
                            <div class="flex flex-wrap gap-1.5">
                                <span class="px-2 py-0.5 bg-zinc-800 text-[9px] uppercase font-mono rounded text-zinc-400">BigQuery</span>
                                <span class="px-2 py-0.5 bg-zinc-800 text-[9px] uppercase font-mono rounded text-zinc-400">dbt</span>
                                <span class="px-2 py-0.5 bg-zinc-800 text-[9px] uppercase font-mono rounded text-zinc-400">Airflow</span>
                                <span class="px-2 py-0.5 bg-zinc-800 text-[9px] uppercase font-mono rounded text-zinc-400">Mixpanel</span>
                                <span class="px-2 py-0.5 bg-zinc-800 text-[9px] uppercase font-mono rounded text-zinc-400">GTM</span>
                                <span class="px-2 py-0.5 bg-zinc-800 text-[9px] uppercase font-mono rounded text-zinc-400">GA4</span>
                                <span class="px-2 py-0.5 bg-zinc-800 text-[9px] uppercase font-mono rounded text-zinc-400">Instagram API</span>
                            </div>
                        </div>
                    </div>
                    <div class="group relative bg-zinc-900 rounded-lg border border-white/5 overflow-hidden hover:border-emerald-500/50 transition-all">
                        <div class="p-5">
                            <div class="flex items-center gap-3 mb-3">
                                <img src="assets/aero.jpg" alt="Aero" class="w-8 h-8 rounded-md object-contain bg-zinc-800 border border-white/5">
                                <h4 class="text-sm font-medium text-white">Aero Data Platform</h4>
                            </div>
                            <p class="text-xs text-zinc-400 mb-3">Scalable eCommerce warehouse processing 50M records/day. 95% data accuracy, 30% cost reduction.</p>
                            <div class="flex flex-wrap gap-1.5">
                                <span class="px-2 py-0.5 bg-zinc-800 text-[9px] uppercase font-mono rounded text-zinc-400">Clickhouse</span>
                                <span class="px-2 py-0.5 bg-zinc-800 text-[9px] uppercase font-mono rounded text-zinc-400">Airflow</span>
                                <span class="px-2 py-0.5 bg-zinc-800 text-[9px] uppercase font-mono rounded text-zinc-400">dbt</span>
                                <span class="px-2 py-0.5 bg-zinc-800 text-[9px] uppercase font-mono rounded text-zinc-400">Nifi</span>
                                <span class="px-2 py-0.5 bg-zinc-800 text-[9px] uppercase font-mono rounded text-zinc-400">Great Expectations</span>
                                <span class="px-2 py-0.5 bg-zinc-800 text-[9px] uppercase font-mono rounded text-zinc-400">Yandex Cloud</span>
                            </div>
                        </div>
                    </div>
                    <div class="group relative bg-zinc-900 rounded-lg border border-white/5 overflow-hidden hover:border-emerald-500/50 transition-all">
                        <div class="p-5">
                            <div class="flex items-center gap-3 mb-3">
                                <img src="assets/blockchain-icon.png" alt="Web3" class="w-8 h-8 rounded-md object-contain bg-zinc-800 border border-white/5">
                                <h4 class="text-sm font-medium text-white">Multi-Chain Analytics</h4>
                            </div>
                            <p class="text-xs text-zinc-400 mb-3">Cross-chain DeFi analytics unifying 6 blockchains and 8+ data sources for real-time investment decisions.</p>
                            <div class="flex flex-wrap gap-1.5">
                                <span class="px-2 py-0.5 bg-zinc-800 text-[9px] uppercase font-mono rounded text-zinc-400">Python</span>
                                <span class="px-2 py-0.5 bg-zinc-800 text-[9px] uppercase font-mono rounded text-zinc-400">Clickhouse</span>
                                <span class="px-2 py-0.5 bg-zinc-800 text-[9px] uppercase font-mono rounded text-zinc-400">PostgreSQL</span>
                                <span class="px-2 py-0.5 bg-zinc-800 text-[9px] uppercase font-mono rounded text-zinc-400">Web3.py</span>
                                <span class="px-2 py-0.5 bg-zinc-800 text-[9px] uppercase font-mono rounded text-zinc-400">Airflow</span>
                                <span class="px-2 py-0.5 bg-zinc-800 text-[9px] uppercase font-mono rounded text-zinc-400">Grafana</span>
                                <span class="px-2 py-0.5 bg-zinc-800 text-[9px] uppercase font-mono rounded text-zinc-400">Blockchain Nodes</span>
                            </div>
                        </div>
                    </div>
                    <div class="group relative bg-zinc-900 rounded-lg border border-white/5 overflow-hidden hover:border-emerald-500/50 transition-all sm:col-span-2">
                        <div class="p-5">
                            <div class="flex items-center gap-3 mb-3">
                                <img src="assets/glowbyte-logo.png" alt="Glowbyte" class="w-8 h-8 rounded-md object-contain bg-zinc-800 border border-white/5">
                                <h4 class="text-sm font-medium text-white">Enterprise Data Integration</h4>
                            </div>
                            <p class="text-xs text-zinc-400 mb-3">13 enterprise integrations managing 1,500+ tables across banking and retail. 30% latency reduction. SIBUR and Lemana PRO case studies.</p>
                            <div class="flex flex-wrap gap-1.5">
                                <span class="px-2 py-0.5 bg-zinc-800 text-[9px] uppercase font-mono rounded text-zinc-400">PostgreSQL</span>
                                <span class="px-2 py-0.5 bg-zinc-800 text-[9px] uppercase font-mono rounded text-zinc-400">Greenplum</span>
                                <span class="px-2 py-0.5 bg-zinc-800 text-[9px] uppercase font-mono rounded text-zinc-400">Vertica</span>
                                <span class="px-2 py-0.5 bg-zinc-800 text-[9px] uppercase font-mono rounded text-zinc-400">Python</span>
                                <span class="px-2 py-0.5 bg-zinc-800 text-[9px] uppercase font-mono rounded text-zinc-400">ETL</span>
                                <span class="px-2 py-0.5 bg-zinc-800 text-[9px] uppercase font-mono rounded text-zinc-400">CI/CD</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mt-6 pt-6 border-t border-zinc-800">
                    <a href="projects.html" class="inline-flex items-center gap-2 text-sm text-emerald-400 hover:text-emerald-300 transition-colors">
                        <span>View all projects</span>
                        <span class="iconify" data-icon="lucide:arrow-right" data-width="14"></span>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- THREE.JS SETUP ---
        const container = document.getElementById('canvas-container');
        const scene = new THREE.Scene();
        const fogColor = new THREE.Color('#09090b');
        scene.background = fogColor;
        scene.fog = new THREE.Fog(fogColor, 20, 80); // Fog for depth

        // Camera (Chase Cam)
        const camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 1000);
        
        const renderer = new THREE.WebGLRenderer({ antialias: true, powerPreference: "high-performance" });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        container.appendChild(renderer.domElement);

        // --- LIGHTING ---
        const ambientLight = new THREE.HemisphereLight(0xffffff, 0x09090b, 0.4);
        scene.add(ambientLight);

        const dirLight = new THREE.DirectionalLight(0xffffff, 1);
        dirLight.position.set(50, 100, 50);
        dirLight.castShadow = true;
        dirLight.shadow.mapSize.width = 2048;
        dirLight.shadow.mapSize.height = 2048;
        dirLight.shadow.camera.near = 0.5;
        dirLight.shadow.camera.far = 200;
        dirLight.shadow.camera.left = -100;
        dirLight.shadow.camera.right = 100;
        dirLight.shadow.camera.top = 100;
        dirLight.shadow.camera.bottom = -100;
        scene.add(dirLight);

        // --- CITY GENERATION ---
        
        // Floor
        const planeGeometry = new THREE.PlaneGeometry(500, 500);
        const planeMaterial = new THREE.MeshStandardMaterial({ 
            color: 0x18181b, // Dark Asphalt
            roughness: 0.9,
            metalness: 0.1
        });
        const plane = new THREE.Mesh(planeGeometry, planeMaterial);
        plane.rotation.x = -Math.PI / 2;
        plane.receiveShadow = true;
        scene.add(plane);

        const cityGroup = new THREE.Group();
        scene.add(cityGroup);

        const buildings = [];
        const zoneLocs = [
            { x: 0, z: 0, r: 15 }, // Spawn
            { x: -30, z: -30, r: 10 }, // About
            { x: 30, z: -30, r: 10 }, // Experience
            { x: 0, z: 40, r: 10 }  // Portfolio
        ];

        function isSafeZone(x, z) {
            return zoneLocs.some(zone => {
                const dist = Math.hypot(x - zone.x, z - zone.z);
                return dist < zone.r;
            });
        }

        // Generate City Blocks
        const buildingGeo = new THREE.BoxGeometry(1, 1, 1);
        const buildingMat = new THREE.MeshStandardMaterial({ color: 0x27272a, roughness: 0.2 });
        const windowMat = new THREE.MeshBasicMaterial({ color: 0x52525b }); // Lights off
        
        for (let i = 0; i < 200; i++) {
            const x = (Math.random() - 0.5) * 160;
            const z = (Math.random() - 0.5) * 160;

            if (isSafeZone(x, z)) continue;

            // Snap to grid for "Streets" effect
            const gridX = Math.round(x / 8) * 8;
            const gridZ = Math.round(z / 8) * 8;
            
            // Random Height
            const h = Math.random() * 8 + 2;
            const w = Math.random() * 2 + 2;
            const d = Math.random() * 2 + 2;

            const mesh = new THREE.Mesh(buildingGeo, buildingMat);
            mesh.position.set(gridX, h/2, gridZ);
            mesh.scale.set(w, h, d);
            mesh.castShadow = true;
            mesh.receiveShadow = true;
            cityGroup.add(mesh);

            // Add "Windows" (Simple small cubes slightly extruded)
            if (Math.random() > 0.5) {
                const win = new THREE.Mesh(buildingGeo, new THREE.MeshBasicMaterial({ 
                    color: Math.random() > 0.8 ? 0xfef08a : 0x3f3f46, 
                    transparent: true, 
                    opacity: 0.8 
                }));
                win.position.set(gridX, h - 1, gridZ + (d/2 + 0.05));
                win.scale.set(w * 0.6, 0.5, 0.1);
                cityGroup.add(win);
            }
        }

        // Trees
        const treeMat = new THREE.MeshStandardMaterial({ color: 0x064e3b, roughness: 0.9 });
        const trunkMat = new THREE.MeshStandardMaterial({ color: 0x3f2e21 });
        const treeGeo = new THREE.ConeGeometry(1, 4, 8);
        const trunkGeo = new THREE.CylinderGeometry(0.2, 0.2, 1);

        for(let i=0; i<60; i++) {
            const x = (Math.random() - 0.5) * 140;
            const z = (Math.random() - 0.5) * 140;
            if (isSafeZone(x, z)) continue;
            
            // Offset from grid to be "sidewalk" trees
            const gridX = Math.round(x / 8) * 8 + 3; 
            const gridZ = Math.round(z / 8) * 8 + 3;

            const trunk = new THREE.Mesh(trunkGeo, trunkMat);
            trunk.position.set(gridX, 0.5, gridZ);
            trunk.castShadow = true;
            cityGroup.add(trunk);

            const leaves = new THREE.Mesh(treeGeo, treeMat);
            leaves.position.set(gridX, 2.5, gridZ);
            leaves.castShadow = true;
            cityGroup.add(leaves);
        }

        // Street Lights
        const poleGeo = new THREE.CylinderGeometry(0.05, 0.05, 4);
        const poleMat = new THREE.MeshStandardMaterial({ color: 0x52525b });
        const bulbGeo = new THREE.SphereGeometry(0.2);
        const bulbMat = new THREE.MeshBasicMaterial({ color: 0xffedd5 });

        for(let i=0; i<20; i++) {
             const x = (Math.random() - 0.5) * 100;
            const z = (Math.random() - 0.5) * 100;
            if (isSafeZone(x, z)) continue;

             const gridX = Math.round(x / 16) * 16 - 4; 
             const gridZ = Math.round(z / 16) * 16 - 4;

             const pole = new THREE.Mesh(poleGeo, poleMat);
             pole.position.set(gridX, 2, gridZ);
             cityGroup.add(pole);

             const bulb = new THREE.Mesh(bulbGeo, bulbMat);
             bulb.position.set(gridX, 4, gridZ);
             cityGroup.add(bulb);

             // Point light for realism
             const pl = new THREE.PointLight(0xffedd5, 0.5, 10);
             pl.position.set(gridX, 3.5, gridZ);
             cityGroup.add(pl);
        }


        // --- CAR SETUP ---
        const carGroup = new THREE.Group();

        // Car Body - Cyberpunk Style
        const chassisGeo = new THREE.BoxGeometry(1.6, 0.6, 3.2);
        const chassisMat = new THREE.MeshStandardMaterial({ color: 0x18181b, roughness: 0.2, metalness: 0.7 });
        const carChassis = new THREE.Mesh(chassisGeo, chassisMat);
        carChassis.position.y = 0.6;
        carChassis.castShadow = true;
        carGroup.add(carChassis);

        // Cabin
        const cabinGeo = new THREE.BoxGeometry(1.4, 0.5, 1.8);
        const cabinMat = new THREE.MeshStandardMaterial({ color: 0x09090b, roughness: 0.1, metalness: 0.9 });
        const cabin = new THREE.Mesh(cabinGeo, cabinMat);
        cabin.position.set(0, 1.1, -0.2);
        carGroup.add(cabin);

        // Glow Strips (Rear)
        const stripGeo = new THREE.BoxGeometry(1.4, 0.05, 0.05);
        const stripMat = new THREE.MeshBasicMaterial({ color: 0xef4444 });
        const rearStrip = new THREE.Mesh(stripGeo, stripMat);
        rearStrip.position.set(0, 0.7, 1.61);
        carGroup.add(rearStrip);
        
        // Headlights
        const hlGeo = new THREE.BoxGeometry(0.4, 0.1, 0.05);
        const hlMat = new THREE.MeshBasicMaterial({ color: 0xbfdbfe });
        const hlLeft = new THREE.Mesh(hlGeo, hlMat);
        hlLeft.position.set(-0.5, 0.6, -1.61);
        const hlRight = new THREE.Mesh(hlGeo, hlMat);
        hlRight.position.set(0.5, 0.6, -1.61);
        carGroup.add(hlLeft);
        carGroup.add(hlRight);

        // Spotlights
        const carSpotL = new THREE.SpotLight(0xbfdbfe, 3, 30, 0.5, 0.5, 1);
        carSpotL.position.set(-0.5, 0.6, -1.5);
        carSpotL.target.position.set(-0.5, 0, -10);
        carGroup.add(carSpotL);
        carGroup.add(carSpotL.target);

        const carSpotR = new THREE.SpotLight(0xbfdbfe, 3, 30, 0.5, 0.5, 1);
        carSpotR.position.set(0.5, 0.6, -1.5);
        carSpotR.target.position.set(0.5, 0, -10);
        carGroup.add(carSpotR);
        carGroup.add(carSpotR.target);

        // Wheels
        const wheelGeo = new THREE.CylinderGeometry(0.35, 0.35, 0.3, 16);
        const wheelMat = new THREE.MeshStandardMaterial({ color: 0x09090b });
        wheelGeo.rotateZ(Math.PI / 2);

        const w1 = new THREE.Mesh(wheelGeo, wheelMat); w1.position.set(0.8, 0.35, 1);
        const w2 = new THREE.Mesh(wheelGeo, wheelMat); w2.position.set(-0.8, 0.35, 1);
        const w3 = new THREE.Mesh(wheelGeo, wheelMat); w3.position.set(0.8, 0.35, -1);
        const w4 = new THREE.Mesh(wheelGeo, wheelMat); w4.position.set(-0.8, 0.35, -1);
        carGroup.add(w1, w2, w3, w4);

        scene.add(carGroup);

        // Particle system for speed trails
        const particleCount = 50;
        const particles = new THREE.BufferGeometry();
        const particlePositions = new Float32Array(particleCount * 3);
        const particleVelocities = [];
        
        for (let i = 0; i < particleCount; i++) {
            particlePositions[i * 3] = 0;
            particlePositions[i * 3 + 1] = 0;
            particlePositions[i * 3 + 2] = 0;
            particleVelocities.push({ x: 0, y: 0, z: 0, life: 0 });
        }
        
        particles.setAttribute('position', new THREE.BufferAttribute(particlePositions, 3));
        const particleMaterial = new THREE.PointsMaterial({
            color: 0xef4444,
            size: 0.3,
            transparent: true,
            opacity: 0.6,
            blending: THREE.AdditiveBlending
        });
        const particleSystem = new THREE.Points(particles, particleMaterial);
        scene.add(particleSystem);
        
        let particleIndex = 0;
        function emitParticle() {
            if (Math.abs(state.speed) > 0.3) {
                const angle = state.angle + Math.PI;
                particleVelocities[particleIndex] = {
                    x: carGroup.position.x + Math.sin(angle) * 2,
                    y: 0.2,
                    z: carGroup.position.z + Math.cos(angle) * 2,
                    life: 1.0
                };
                particleIndex = (particleIndex + 1) % particleCount;
            }
        }
        
        function updateParticles() {
            const positions = particles.attributes.position.array;
            for (let i = 0; i < particleCount; i++) {
                if (particleVelocities[i].life > 0) {
                    positions[i * 3] = particleVelocities[i].x;
                    positions[i * 3 + 1] = particleVelocities[i].y;
                    positions[i * 3 + 2] = particleVelocities[i].z;
                    particleVelocities[i].life -= 0.02;
                    particleVelocities[i].y -= 0.01;
                } else {
                    positions[i * 3 + 1] = -100;
                }
            }
            particles.attributes.position.needsUpdate = true;
        }

        // --- ZONES ---
        const zones = [
            { id: 'about', x: -30, z: -30, color: 0xa855f7 },
            { id: 'experience', x: 30, z: -30, color: 0x3b82f6 },
            { id: 'portfolio', x: 0, z: 40, color: 0x10b981 }
        ];

        zones.forEach(zone => {
            // Zone Ground Marker
            const geo = new THREE.RingGeometry(3, 3.2, 32);
            const mat = new THREE.MeshBasicMaterial({ color: zone.color, side: THREE.DoubleSide, transparent: true, opacity: 0.8 });
            const ring = new THREE.Mesh(geo, mat);
            ring.rotation.x = -Math.PI / 2;
            ring.position.set(zone.x, 0.1, zone.z);
            scene.add(ring);

            // Floating Particles or Light Beacon
            const beaconGeo = new THREE.CylinderGeometry(0.1, 0.1, 20, 8);
            const beaconMat = new THREE.MeshBasicMaterial({ color: zone.color, transparent: true, opacity: 0.2 });
            const beacon = new THREE.Mesh(beaconGeo, beaconMat);
            beacon.position.set(zone.x, 10, zone.z);
            scene.add(beacon);

            // Floor Light
            const pLight = new THREE.PointLight(zone.color, 1, 10);
            pLight.position.set(zone.x, 2, zone.z);
            scene.add(pLight);
        });

        // --- GAME LOGIC ---
        const state = {
            speed: 0,
            angle: Math.PI,
            keys: { w: false, a: false, s: false, d: false },
            activeZone: null,
            modalOpen: false,
            totalDistance: 0,
            zonesVisited: new Set(),
            firstTime: !localStorage.getItem('cvGamePlayed'),
            soundEnabled: true
        };

        const ACCELERATION = 0.0125;  // Half of 0.025
        const FRICTION = 0.96;
        const MAX_SPEED = 0.35;  // Half of 0.7
        const ROTATION_SPEED = 0.055;
        
        // Simple engine sound using Web Audio API
        let audioContext, engineOscillator, engineGain;
        
        function initSound() {
            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                // Engine sound (low frequency oscillator)
                engineOscillator = audioContext.createOscillator();
                engineOscillator.type = 'sawtooth';
                engineOscillator.frequency.setValueAtTime(40, audioContext.currentTime);
                
                engineGain = audioContext.createGain();
                engineGain.gain.setValueAtTime(0, audioContext.currentTime);
                
                engineOscillator.connect(engineGain);
                engineGain.connect(audioContext.destination);
                
                engineOscillator.start();
            } catch (e) {
                console.log('Audio not supported');
                state.soundEnabled = false;
            }
        }
        
        function updateEngineSound() {
            if (!state.soundEnabled || !engineOscillator || !engineGain) return;
            
            const speedRatio = Math.abs(state.speed) / MAX_SPEED;
            const frequency = 40 + speedRatio * 60;
            const volume = Math.min(speedRatio * 0.08, 0.08);
            
            engineOscillator.frequency.setTargetAtTime(
                frequency, 
                audioContext.currentTime, 
                0.1
            );
            engineGain.gain.setTargetAtTime(
                volume, 
                audioContext.currentTime, 
                0.1
            );
        }

        // UI Refs
        const alertEl = document.getElementById('proximity-alert');
        const coordsEl = document.getElementById('coords');
        const modalContainer = document.getElementById('modal-container');

        // Input - IMPROVED with focus management
        window.addEventListener('keydown', (e) => {
            // Modal handling
            if (state.modalOpen) {
                if(e.key === 'Escape') {
                    e.preventDefault();
                    closeModal();
                }
                return;
            }
            
            const k = e.key.toLowerCase();
            
            // Prevent default for game keys to avoid browser scroll
            if (['w', 'a', 's', 'd', 'arrowup', 'arrowdown', 'arrowleft', 'arrowright', ' '].includes(k)) {
                e.preventDefault();
            }
            
            // Map arrow keys to WASD
            const keyMap = {
                'arrowup': 'w',
                'arrowdown': 's', 
                'arrowleft': 'a',
                'arrowright': 'd'
            };
            const mappedKey = keyMap[k] || k;
            
            if (state.keys.hasOwnProperty(mappedKey)) {
                state.keys[mappedKey] = true;
                const keyEl = document.getElementById(`key-${mappedKey}`);
                if(keyEl) keyEl.classList.add('pressed');
            }

            if ((e.key === 'Enter' || e.key === ' ') && state.activeZone) {
                e.preventDefault();
                openModal(state.activeZone);
            }
            
            // ESC to return to main website (when modal is not open)
            if (e.key === 'Escape' && !state.modalOpen) {
                e.preventDefault();
                if (confirm('Return to portfolio website?')) {
                    window.location.href = 'projects.html';
                }
            }
        });

        window.addEventListener('keyup', (e) => {
            const k = e.key.toLowerCase();
            
            // Prevent default for game keys
            if (['w', 'a', 's', 'd', 'arrowup', 'arrowdown', 'arrowleft', 'arrowright'].includes(k)) {
                e.preventDefault();
            }
            
            // Map arrow keys to WASD
            const keyMap = {
                'arrowup': 'w',
                'arrowdown': 's',
                'arrowleft': 'a',
                'arrowright': 'd'
            };
            const mappedKey = keyMap[k] || k;
            
            if (state.keys.hasOwnProperty(mappedKey)) {
                state.keys[mappedKey] = false;
                const keyEl = document.getElementById(`key-${mappedKey}`);
                if(keyEl) keyEl.classList.remove('pressed');
            }
        });

        // Maintain focus on window (critical for keyboard controls)
        window.addEventListener('blur', () => {
            // Reset all keys when window loses focus
            Object.keys(state.keys).forEach(key => state.keys[key] = false);
        });

        // Click anywhere to regain focus
        document.body.addEventListener('click', () => {
            window.focus();
        });

        const btnMap = { 'btn-gas': 'w', 'btn-brake': 's', 'btn-left': 'a', 'btn-right': 'd' };
        Object.entries(btnMap).forEach(([btnId, key]) => {
            const btn = document.getElementById(btnId);
            if(btn) {
                const press = (e) => { e.preventDefault(); state.keys[key] = true; };
                const release = (e) => { e.preventDefault(); state.keys[key] = false; };
                btn.addEventListener('touchstart', press);
                btn.addEventListener('touchend', release);
                btn.addEventListener('mousedown', press);
                btn.addEventListener('mouseup', release);
            }
        });

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // Tutorial logic
        const tutorialEl = document.getElementById('tutorial');
        const startBtn = document.getElementById('startBtn');
        
        function showTutorial() {
            if (state.firstTime) {
                tutorialEl.style.display = 'flex';
                setTimeout(() => tutorialEl.style.opacity = '1', 10);
            }
        }
        
        function hideTutorial() {
            tutorialEl.style.opacity = '0';
            setTimeout(() => {
                tutorialEl.style.display = 'none';
                localStorage.setItem('cvGamePlayed', 'true');
            }, 500);
            
            // Initialize sound on user interaction
            initSound();
        }
        
        if (startBtn) {
            startBtn.addEventListener('click', hideTutorial);
        }

        // UI update helpers
        const zonesFoundEl = document.getElementById('zonesFound');
        const distanceTraveledEl = document.getElementById('distanceTraveled');
        
        function updateStats() {
            if (zonesFoundEl) {
                zonesFoundEl.textContent = state.zonesVisited.size;
            }
            if (distanceTraveledEl) {
                distanceTraveledEl.textContent = Math.round(state.totalDistance);
            }
        }

        function updateLabels() {
            zones.forEach(zone => {
                const el = document.getElementById(`label-${zone.id}`);
                if (!el) return;

                const pos = new THREE.Vector3(zone.x, 3.5, zone.z);
                pos.project(camera);

                const x = (pos.x * 0.5 + 0.5) * window.innerWidth;
                const y = (-(pos.y * 0.5) + 0.5) * window.innerHeight;

                const dist = carGroup.position.distanceTo(new THREE.Vector3(zone.x, 0, zone.z));
                const maxDist = 40;

                if (pos.z < 1 && dist < maxDist) {
                    el.style.left = `${x}px`;
                    el.style.top = `${y}px`;
                    el.classList.remove('opacity-0');
                    // Scale effect based on distance
                    const scale = Math.max(0.7, 1 - dist/maxDist);
                    el.style.transform = `translate(-50%, -50%) scale(${scale})`;
                } else {
                    el.classList.add('opacity-0');
                }
            });
        }

        // --- ANIMATION LOOP ---
        let lastPosition = new THREE.Vector3();
        
        function animate() {
            requestAnimationFrame(animate);

            if (!state.modalOpen) {
                // Track distance
                const currentSpeed = Math.abs(state.speed);
                if (currentSpeed > 0.01) {
                    state.totalDistance += currentSpeed;
                }
                
                // Physics
                if (state.keys.w) state.speed += ACCELERATION;
                if (state.keys.s) state.speed -= ACCELERATION;
                
                state.speed *= FRICTION;
                state.speed = Math.max(-MAX_SPEED, Math.min(MAX_SPEED, state.speed));

                // Steering - always allow turning
                // When moving, steering direction depends on forward/reverse
                if (state.keys.a || state.keys.d) {
                    const direction = Math.abs(state.speed) > 0.01 ? (state.speed > 0 ? 1 : -1) : 1;
                    if (state.keys.a) state.angle += ROTATION_SPEED * direction;
                    if (state.keys.d) state.angle -= ROTATION_SPEED * direction;
                }

                // Move Car
                carGroup.rotation.y = state.angle;
                carGroup.position.x -= Math.sin(state.angle) * state.speed;
                carGroup.position.z -= Math.cos(state.angle) * state.speed;

                // Animate headlight intensity based on speed
                if (carSpotL && carSpotR) {
                    const intensity = 2 + Math.abs(state.speed) * 3;
                    carSpotL.intensity = intensity;
                    carSpotR.intensity = intensity;
                }

                // Camera logic (Third Person / Chase)
                const idealOffset = new THREE.Vector3(0, 5, 10);
                idealOffset.applyAxisAngle(new THREE.Vector3(0, 1, 0), state.angle);
                idealOffset.add(carGroup.position);

                camera.position.lerp(idealOffset, 0.1);
                
                const lookAtPos = new THREE.Vector3(0, 0, -10);
                lookAtPos.applyAxisAngle(new THREE.Vector3(0, 1, 0), state.angle);
                lookAtPos.add(carGroup.position);
                camera.lookAt(lookAtPos);
                
                // Emit particles when moving fast
                if (Math.random() < 0.3) emitParticle();
                
                // Update engine sound
                updateEngineSound();
            }
            
            // Always update particles
            updateParticles();

            // Proximity Check with zone tracking
            let nearbyZone = null;
            zones.forEach(zone => {
                const dist = Math.hypot(carGroup.position.x - zone.x, carGroup.position.z - zone.z);
                if (dist < 5) {
                    nearbyZone = zone.id;
                    // Track discovered zones
                    if (!state.zonesVisited.has(zone.id)) {
                        state.zonesVisited.add(zone.id);
                        updateStats();
                        
                        // All zones visited!
                        if (state.zonesVisited.size === 3 && !state.completionShown) {
                            state.completionShown = true;
                            setTimeout(() => {
                                if (!state.modalOpen) {
                                    alert('🎉 Achievement Unlocked!\n\nYou explored all zones!\n\nThanks for checking out my interactive CV.');
                                }
                            }, 500);
                        }
                    }
                }
            });

            if (nearbyZone !== state.activeZone) {
                state.activeZone = nearbyZone;
                if (nearbyZone) {
                    alertEl.classList.remove('opacity-0', 'scale-90', 'translate-y-4');
                    alertEl.classList.add('opacity-100', 'scale-100', 'translate-y-0');
                } else {
                    alertEl.classList.add('opacity-0', 'scale-90', 'translate-y-4');
                    alertEl.classList.remove('opacity-100', 'scale-100', 'translate-y-0');
                }
            }

            coordsEl.innerText = `POS: ${Math.round(carGroup.position.x)}, ${Math.round(carGroup.position.z)}`;
            updateLabels();
            
            // Update speedometer
            const speedKmh = Math.round(Math.abs(state.speed) * 100);
            const speedometerMobile = document.getElementById('speedometer-mobile');
            if (speedometerMobile) speedometerMobile.textContent = speedKmh;
            
            // Update stats periodically
            if (Math.random() < 0.01) updateStats();

            renderer.render(scene, camera);
        }

        // Modal Handlers
        function openModal(zoneId) {
            state.modalOpen = true;
            state.speed = 0;
            modalContainer.classList.remove('hidden');
            
            document.querySelectorAll('.modal-panel').forEach(p => {
                p.classList.add('hidden', 'opacity-0', 'scale-95');
            });

            const panel = document.getElementById(`modal-${zoneId}`);
            if (panel) {
                panel.classList.remove('hidden');
                setTimeout(() => {
                    panel.classList.remove('opacity-0', 'scale-95');
                    panel.classList.add('opacity-100', 'scale-100');
                }, 10);
            }
        }

        function closeModal() {
            const panels = document.querySelectorAll('.modal-panel:not(.hidden)');
            panels.forEach(p => {
                p.classList.remove('opacity-100', 'scale-100');
                p.classList.add('opacity-0', 'scale-95');
            });

            setTimeout(() => {
                modalContainer.classList.add('hidden');
                state.modalOpen = false;
            }, 300);
        }

        document.querySelectorAll('.close-modal').forEach(btn => btn.addEventListener('click', closeModal));

        // Start game and show tutorial if first time
        setTimeout(() => {
            showTutorial();
        }, 500);
        
        animate();

    </script>

</body></html>